<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor</title>
    <style>
        :root {
            --title-bar-bg: #252526; /* Adjusted for slightly more contrast from image */
            --status-bar-bg: #252526;
            --tab-bar-bg: #2D2D2D;
            --active-tab-bg: #1E1E1E; /* Editor bg, active tab often merges */
            --inactive-tab-bg: #2D2D2D;
            --editor-bg: #1E1E1E;
            --text-color: #CCCCCC;
            --icon-color: #ADADAD;
            --icon-hover-color: #FFFFFF;
            --line-number-color: #858585;
            --gutter-bg: #1E1E1E; /* Gutter usually matches editor bg */

            --control-red: #FF605C;
            --control-yellow: #FFBD44;
            --control-green: #00CA4E;

            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        body {
            margin: 0;
            font-family: var(--font-family);
            background-color: var(--title-bar-bg);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background-color: var(--editor-bg); /* Fallback for main area */
        }

        .title-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--title-bar-bg);
            padding: 8px 12px;
            height: 28px; /* Approximate height */
            -webkit-app-region: drag; /* For potential Electron apps, not functional in browser */
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .red { background-color: var(--control-red); }
        .yellow { background-color: var(--control-yellow); }
        .green { background-color: var(--control-green); }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            font-size: 13px;
        }

        .user-info .status-dot {
            width: 8px;
            height: 8px;
            background-color: var(--control-green);
            border-radius: 50%;
        }

        .user-info .user-icon svg {
            width: 18px;
            height: 18px;
            fill: var(--icon-color);
        }

        .tab-bar {
            display: flex;
            align-items: flex-end; /* Align tabs to the bottom of the bar */
            background-color: var(--tab-bar-bg);
            padding: 0 5px; /* Padding for the bar itself */
            height: 40px; /* Approximate height */
            flex-shrink: 0;
            overflow-x: auto; /* Allows horizontal scrolling if many tabs */
        }

        .tabs-list {
            display: flex;
            align-items: flex-end;
            list-style: none;
            margin: 0;
            padding: 0;
            height: 100%;
        }

        .tab {
            display: flex;
            align-items: center;
            padding: 0 10px;
            height: 35px; /* Height of the tab itself */
            line-height: 35px;
            background-color: var(--inactive-tab-bg);
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-color);
            margin-right: 1px; /* Separator line */
            position: relative; /* For positioning close button */
            border: 1px solid transparent; /* For active state border */
            border-bottom: none;
            max-width: 200px; /* Prevent tabs from getting too wide */
        }
        .tab:not(.active-tab) {
             background-color: #333333; /* Slightly different for inactive if desired */
             color: #9e9e9e; /* Dimmer text for inactive */
             height: 32px; /* Slightly shorter inactive tabs */
             line-height: 32px;
             align-self: flex-end; /* Stick to bottom */
             margin-top: 3px; /* To appear "behind" active */
        }


        .tab.active-tab {
            background-color: var(--active-tab-bg);
            color: var(--text-color);
            height: 35px;
            line-height: 35px;
            border-color: var(--active-tab-bg); /* Make it blend with editor */
            position: relative;
            z-index: 1;
        }

        .tab-icon svg {
            width: 16px;
            height: 16px;
            fill: var(--icon-color);
            margin-right: 6px;
        }
        .tab.active-tab .tab-icon svg {
            fill: var(--text-color); /* Brighter icon for active tab */
        }


        .tab-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 5px; /* Space for close button if title is short */
        }

        .tab-title-input {
            background-color: inherit;
            color: inherit;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: inherit;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .close-tab-btn {
            background: none;
            border: none;
            color: var(--icon-color);
            cursor: pointer;
            padding: 0 4px;
            margin-left: auto; /* Pushes to the right */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            opacity: 0.7;
        }
        .close-tab-btn:hover {
            background-color: rgba(255,255,255,0.1);
            color: var(--icon-hover-color);
            opacity: 1;
        }
        .close-tab-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .add-tab-btn {
            background: none;
            border: none;
            color: var(--icon-color);
            cursor: pointer;
            padding: 0 8px; /* More padding for the button itself */
            margin-left: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 30px; /* Align with inactive tab height */
            align-self: flex-end; /* Stick to bottom of tab bar */
            margin-bottom: 2px; /* Align with inactive tabs */
        }
        .add-tab-btn:hover {
            color: var(--icon-hover-color);
        }
        .add-tab-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .editor-container {
            flex-grow: 1;
            background-color: var(--editor-bg);
            overflow: hidden; /* Monaco handles its own scroll */
            position: relative; /* For Monaco's absolute elements */
        }

        #monaco-editor {
            width: 100%;
            height: 100%;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--status-bar-bg);
            padding: 4px 12px;
            height: 22px; /* Approximate height */
            flex-shrink: 0;
        }

        .status-bar-left, .status-bar-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-bar-icon {
            display: flex;
            align-items: center;
            color: var(--icon-color);
            cursor: pointer;
        }
        .status-bar-icon:hover {
            color: var(--icon-hover-color);
        }
        .status-bar-icon svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Scrollbar styling (optional, for WebKit browsers) */
        .tab-bar::-webkit-scrollbar {
            height: 3px;
        }
        .tab-bar::-webkit-scrollbar-thumb {
            background: #555;
        }
        .tab-bar::-webkit-scrollbar-track {
            background: var(--tab-bar-bg);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="title-bar">
            <div class="window-controls">
                <div class="control-dot red"></div>
                <div class="control-dot yellow"></div>
                <div class="control-dot green"></div>
            </div>
            <div class="user-info">
                <div class="status-dot"></div>
                <span>Canda</span>
                <div class="user-icon">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
            </div>
        </div>

        <div class="tab-bar">
            <ul class="tabs-list" id="tabsList">
                </ul>
            <button class="add-tab-btn" id="addTabBtn" title="New Tab">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </button>
        </div>

        <div class="editor-container">
            <div id="monaco-editor"></div>
        </div>

        <div class="status-bar">
            <div class="status-bar-left">
                <div class="status-bar-icon" title="Run">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <div class="status-bar-icon" title="Source Control">
                    <svg viewBox="0 0 24 24"><path d="M6 18H4V9h2m10.5-4A2.5 2.5 0 0014 7.5V9h-4V7.5A2.5 2.5 0 007.5 5A2.5 2.5 0 005 7.5V10H2v4h3v2.5A2.5 2.5 0 007.5 19a2.5 2.5 0 002.5-2.5V15h4v1.5a2.5 2.5 0 002.5 2.5A2.5 2.5 0 0019 16.5V14h3v-4h-3V7.5A2.5 2.5 0 0016.5 5M10 13v-2h4v2Z"/></svg>
                </div>
            </div>
            <div class="status-bar-right">
                <div class="status-bar-icon" title="Problems">
                     <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
                </div>
                <div class="status-bar-icon" title="Explorer">
                    <svg viewBox="0 0 24 24"><path d="M10 4H4c-1.11 0-2 .89-2 2v12a2 2 0 002 2h16a2 2 0 002-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/></svg>
                </div>
                 <div class="status-bar-icon" title="Outline">
                    <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                </div>
                <div class="status-bar-icon" title="Settings">
                    <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.48.0/min/vs/loader.js"></script>
    <script>
        let editor;
        let tabs = [];
        let activeTabId = null;
        let nextTabId = 1;

        const tabsListElement = document.getElementById('tabsList');
        const addTabBtn = document.getElementById('addTabBtn');
        const monacoEditorElement = document.getElementById('monaco-editor');

        // Monaco Editor Loader
        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.48.0/min/vs' }});
        window.MonacoEnvironment = { getWorkerUrl: () => proxy };
        let proxy = URL.createObjectURL(new Blob([`
            self.MonacoEnvironment = { baseUrl: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.48.0/min/' };
            importScripts('https://cdn.jsdelivr.net/npm/monaco-editor@0.48.0/min/vs/base/worker/workerMain.js');
        `], { type: 'text/javascript' }));

        require(["vs/editor/editor.main"], function () {
            editor = monaco.editor.create(monacoEditorElement, {
                language: 'lua', // Default language
                theme: 'vs-dark', // Matches the dark theme
                minimap: { enabled: true },
                automaticLayout: true, // Adjusts editor size on container resize
                glyphMargin: true,
                lineNumbersMinChars: 3,
                fontFamily: "Consolas, 'Courier New', monospace", // Typical coding font
                fontSize: 14,
                scrollbar: {
                    verticalScrollbarSize: 10,
                    horizontalScrollbarSize: 10,
                },
                // Match image's editor background if 'vs-dark' isn't precise enough
                // This can be done via a custom theme or overriding specific colors
                // For example:
                // monaco.editor.defineTheme('myCustomTheme', {
                //     base: 'vs-dark',
                //     inherit: true,
                //     rules: [{ background: '1E1E1E' }], // Editor background
                //     colors: {
                //         'editor.background': '#1E1E1E',
                //         'editorGutter.background': '#1E1E1E', // Gutter background
                //         'editorLineNumber.foreground': '#858585'
                //     }
                // });
                // monaco.editor.setTheme('myCustomTheme');
            });

            // Initial tab
            createNewTab("Untitled");
            createNewTab("ArsenalG...", `local RunService = game:GetService('RunService')
local TweenService = game:GetService('TweenService')

local UserInputService = game:GetService('UserInputService')
local Players = game:GetService('Players')

local LocalPlayer, LocalPlayer = Players.LocalPlayer, Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local Backpack = LocalPlayer.Backpack
local Camera, camera = workspace.CurrentCamera, workspace.CurrentCamera

local slower, supper = string.lower, string.upper
local sFind = string.find

local Module = {

}
`);
            if (tabs.length > 1) setActiveTab(tabs[1].id);
            else if (tabs.length === 1) setActiveTab(tabs[0].id);

        });

        function createNewTab(title = "Untitled", content = "") {
            const tabId = `tab-${nextTabId++}`;
            const newTab = {
                id: tabId,
                title: title,
                content: content,
                viewState: null // To store editor state (scroll, cursor)
            };
            tabs.push(newTab);
            renderTabs();
            setActiveTab(tabId);
            return newTab;
        }

        function closeTab(tabIdToClose) {
            const tabIndex = tabs.findIndex(tab => tab.id === tabIdToClose);
            if (tabIndex === -1) return;

            tabs.splice(tabIndex, 1);

            if (activeTabId === tabIdToClose) {
                activeTabId = null; // Clear active tab
                if (tabs.length > 0) {
                    // Activate the previous tab, or the first one if the closed one was first
                    const newActiveIndex = Math.max(0, tabIndex - 1);
                    setActiveTab(tabs[newActiveIndex].id);
                } else {
                    // No tabs left
                    if (editor) editor.setValue("");
                    // Optionally, create a new empty tab or show a placeholder
                }
            }
            renderTabs();
            if (tabs.length === 0) { // If last tab closed
                editor.setValue(''); // Clear editor
                // Optionally create a new default tab
                // createNewTab();
            }
        }

        function setActiveTab(tabId) {
            const currentActiveTab = tabs.find(tab => tab.id === activeTabId);
            if (currentActiveTab && editor) {
                currentActiveTab.viewState = editor.saveViewState(); // Save current view state
            }

            activeTabId = tabId;
            const newActiveTabData = tabs.find(tab => tab.id === tabId);

            if (newActiveTabData && editor) {
                editor.setValue(newActiveTabData.content);
                if (newActiveTabData.viewState) {
                    editor.restoreViewState(newActiveTabData.viewState);
                }
                editor.focus(); // Focus the editor
            } else if (!newActiveTabData && editor) {
                // This case should ideally not happen if a tab is being set active
                editor.setValue(""); // Clear editor if no tab data
            }
            renderTabs();
        }

        function updateTabContent() {
            if (!activeTabId || !editor) return;
            const activeTabData = tabs.find(tab => tab.id === activeTabId);
            if (activeTabData) {
                activeTabData.content = editor.getValue();
            }
        }

        function renderTabs() {
            tabsListElement.innerHTML = ''; // Clear existing tabs
            tabs.forEach(tabData => {
                const tabElement = document.createElement('li');
                tabElement.className = 'tab';
                tabElement.dataset.tabId = tabData.id;
                if (tabData.id === activeTabId) {
                    tabElement.classList.add('active-tab');
                }

                // Tab Icon
                const iconElement = document.createElement('span');
                iconElement.className = 'tab-icon';
                iconElement.innerHTML = `<svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`; // Document Icon

                // Tab Title Span (for displaying or input)
                const titleSpan = document.createElement('span');
                titleSpan.className = 'tab-title';
                titleSpan.textContent = tabData.title;

                // Close Button
                const closeBtn = document.createElement('button');
                closeBtn.className = 'close-tab-btn';
                closeBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>`; // Close Icon
                closeBtn.title = "Close Tab";
                closeBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent tab click event
                    closeTab(tabData.id);
                });

                tabElement.appendChild(iconElement);
                tabElement.appendChild(titleSpan);
                tabElement.appendChild(closeBtn);

                tabElement.addEventListener('click', () => {
                    setActiveTab(tabData.id);
                });

                // Double-click to rename
                titleSpan.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    const currentTitle = tabData.title;
                    titleSpan.innerHTML = ''; // Clear current title text
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentTitle;
                    input.className = 'tab-title-input';
                    input.style.width = (titleSpan.offsetWidth > 50 ? titleSpan.offsetWidth : 100) + 'px'; // approximate width


                    input.addEventListener('blur', finishRename);
                    input.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter') {
                            finishRename();
                        } else if (event.key === 'Escape') {
                            input.value = currentTitle; // Revert
                            finishRename();
                        }
                    });

                    function finishRename() {
                        const newTitle = input.value.trim();
                        if (newTitle && newTitle !== currentTitle) {
                            tabData.title = newTitle;
                        }
                        // Re-render tabs to reflect change or simply update the text content
                        titleSpan.textContent = tabData.title;
                        // Ensure input is removed if it was part of titleSpan
                         if (input.parentNode === titleSpan) {
                             titleSpan.removeChild(input);
                         }
                         renderTabs(); // Re-render to ensure all styles and structures are correct
                    }

                    titleSpan.appendChild(input);
                    input.focus();
                    input.select();
                });


                tabsListElement.appendChild(tabElement);
            });
        }

        addTabBtn.addEventListener('click', () => createNewTab());

        // Listen for content changes in Monaco to update the active tab's data
        if (editor) { // Check if editor is initialized
            editor.onDidChangeModelContent(() => {
                updateTabContent();
            });
        } else { // If editor not ready yet, set up listener after init
             const observer = new MutationObserver((mutationsList, obs) => {
                if (window.monaco && monacoEditorElement.childElementCount > 0 && !editor.onDidChangeModelContent) { // Basic check
                    if (editor && typeof editor.onDidChangeModelContent === 'function') {
                        editor.onDidChangeModelContent(() => {
                            updateTabContent();
                        });
                        obs.disconnect(); // Stop observing once editor is ready
                    }
                }
            });
            observer.observe(monacoEditorElement, { childList: true, subtree: true });
        }

        // Ensure layout is handled on resize (Monaco's automaticLayout helps here)
        window.addEventListener('resize', () => {
            if (editor) {
                // editor.layout(); // automaticLayout should handle this
            }
        });

    </script>
</body>
</html>
